define(["jquery"],function($){var formatdatetime=function(strDate){var ret,arrDate;try{if(/^T/.test(strDate)){arrDate=strDate.match(/(\d{2})(\d{2})(\d{2})/);arrDate.shift();ret=new Date(0,0,0,arrDate[0],arrDate[1],arrDate[2]);ret.type="time";ret.date=null;ret.time=ret.value=arrDate.join(":");}else{if(/\d{8}/.test(strDate)){arrDate=strDate.match(/(\d{4})(\d{2})(\d{2})/);arrDate.shift();ret=new Date(arrDate[0],arrDate[1]-1,arrDate[2],0,0,0);ret.type="date";ret.time=null;ret.date=ret.value=arrDate.join("-");}else{arrDate=strDate.match(/(\d{4})(\d2)(\d{2})T(\d{2})(\d{2})(\d{2}).*/);arrDate.shift();ret=new Date(arrDate[0],arrDate[1]-1,arrDate[2],arrDate[3],arrDate[4],arrDate[5]);ret.type="datetime";ret.date=arrDate[0]+"-"+arrDate[1]+"-"+arrDate[2];ret.time=arrDate[3]+":"+arrDate[4]+":"+arrDate[5];ret.value=ret.date+" "+ret.time;}}}catch(e){ret=new Date();ret.value=strDate;}ret.org=strDate;return ret;};return function(data,opts){if(!data){return[];}$.extend(opts,{expand:0});var originalname,results=[];if(!data.viewentry){results.total=0;return results;}results.total=data["@toplevelentries"];$.each(data.viewentry,function(_i,entry){if(opts.expand!=0&&opts.expand!=entry["@position"].replace(/(.*)\.\d+$/,"$1")){return false;}var _j;var item={_position:entry["@position"],_notesid:entry["@noteid"],_siblingsCount:entry["@siblings"]};if(entry["@unread"]){item._unread=true;}if(entry["@children"]){item._childrenCount=entry["@children"];item._descendantsCount=entry["@descendants"];item._children=item._position;}else{item._unid=entry["@unid"];}var _columns=[];for(_j in entry.entrydata){if(isNaN(_j)){continue;}var _val;if(entry.entrydata[_j].text){_val=entry.entrydata[_j].text[0].replace(/[\n\r\t]/,"");}else{if(entry.entrydata[_j].textlist){_val=[];var i;for(i in entry.entrydata[_j].textlist.text){_val.push(entry.entrydata[_j].textlist.text[i][0]);}}else{if(entry.entrydata[_j].number){_val=entry.entrydata[_j].number[0];}else{if(entry.entrydata[_j].numberlist){_val=[];var i;for(i in entry.entrydata[_j].numberlist.number){_val.push(entry.entrydata[_j].numberlist.number[i][0]);}}else{if(entry.entrydata[_j].datetime){_val=formatdatetime(entry.entrydata[_j].datetime[0]);}else{if(entry.entrydata[_j].datetimelist){_val=[];var i;for(i in entry.entrydata[_j].datetimelist.datetime){_val.push(formatdatetime(entry.entrydata[_j].datetimelist.datetime[i][0]));}}else{_val=formatdatetime(entry.entrydata[_j]);}}}}}}_columns[_j]=entry.entrydata[_j]["@name"].toLowerCase().replace(/^\$/gi,"_");item._columns=_columns;item[_columns[_j]]=_val;}results.push(item);});return results;};});